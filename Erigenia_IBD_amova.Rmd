---
title: "Erigenia_IBD_amova"
author: "CLM"
date: "8/3/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

BELOW IS CODE FROM BAPTISIA ANALYSES WITH DARTR- edit to work for Erigenia
 
 
#Mantel Test 

```{r}
coords <- read.csv ("coords.csv", header=TRUE) #for each pop
coords_all<-read.csv("coords_all.csv", header=TRUE) #for each individual
```

```{r alternative to assigning coords_all to the gl}
Dgen <- gl.dist.pop(Bap_allB_genlight, method="euclidean")
Dgeo <- dist(coords)
```
```{r}
Dgen
```

```{r}
Bap_allB_genlight@other$latlong<-coords_all
Bap_allB_genlight@other$latlong
Bap_allB_genlight@pop
```

```{r}
Bap_ibd<- gl.ibd(gl = Bap_allB_genlight, Dgen = NULL, Dgeo = NULL, projected = TRUE,
  permutations = 999, plot = TRUE)
```
Call:
mantel(xdis = Dgen, ydis = Dgeo, permutations = 999, na.rm = TRUE) 

Mantel statistic r:   NaN 
      Significance: NA 

Upper quantiles of permutations (null model):
  90%   95% 97.5%   99% 
   NA    NA    NA    NA 
Permutation: free
Number of permutations: 999

```{r}
Bap_ibd_<- gl.ibd(gl = NULL, Dgen = Dgen, Dgeo = Dgeo, projected = TRUE,
  permutations = 999, plot = TRUE)
```
bandwidth error has to do with population, b/c multiple individuals have the same coordinates it is not happy


```{r}
Bap_ibd_2<- mantel.randtest(Dgen, Dgeo)
```


```{r}
Bap_ibd_2
plot(Bap_ibd_2)
```

Try it w/o Ernst
```{r}
Bap_ibd_noErnst<- gl.ibd(gl = Bap_allB_gl_noErnst, Dgen = NULL, Dgeo = NULL, projected = TRUE,
  permutations = 999, plot = TRUE)
```

Heck yeah it worked!
Mantel statistic r: 0.6112 
      Significance: 0.001 

Upper quantiles of permutations (null model):
  90%   95% 97.5%   99% 
0.173 0.280 0.425 0.457 
Permutation: free
Number of permutations: 999
```{r}
Bap_ibd_noErnst
```

```{r}
Bap_ibd_Allegheny<- gl.ibd(gl = Bap_allB_gl_Allegheny, Dgen = NULL, Dgeo = NULL, projected = TRUE,
  permutations = 999, plot = TRUE)

```
Mantel statistic r: 0.5922 
      Significance: 0.001 

Upper quantiles of permutations (null model):
  90%   95% 97.5%   99% 
0.166 0.197 0.232 0.266 
Permutation: free
Number of permutations: 999


What does this mean? http://qiime.org/1.5.0/tutorials/distance_matrix_comparison.html

#AMOVA

https://grunwaldlab.github.io/Population_Genetics_in_R/AMOVA.html
https://grunwaldlab.github.io/poppr/reference/poppr.amova.html
https://rdrr.io/cran/dartR/man/gl.amova.html

```{r}
Erigenia_amova<-gl.amova(new_Erigenia_gl)
```

```{r}
Erigenia_amova
```
	Analysis of Molecular Variance

Call: amova(formula = dist ~ pop.names, nperm = perm)

               SSD        MSD  df
pop.names 7.878932 1.12556178   7
Error     1.338694 0.01216994 110
Total     9.217626 0.07878313 117

Variance components:
            sigma2 P.value
pop.names 0.075867       0
Error     0.012170        

Phi-statistics:
pop.names.in.GLOBAL 
          0.8617635 

Variance coefficients:
       a 
14.67554 

Idk what this mean, will have to look into output
